<header class="page-header">
  <div class="pull-right">
    <% EventType.all.each do |event_type| %>
      <div class="badge"><%= event_type.name %>: <%= event_type.events.count %></div>
    <% end %>
  </div>

 <h1>Lichtschrankenereignisse <small>Total: <%= @events.size %></small></h1>
</header>

<div class="pull-right">
  <%= link_to 'Kalenderansicht', calendar_events_path, :class => 'btn btn-link' %>
  <%= link_to 'New Event', new_event_path, :class => 'btn btn-link' %>
  <%= link_to 'Gib mir alles!', events_path(:from_time => Event.first.timestamp, :to_time => Event.last.timestamp), :class => 'btn btn-default' %>
</div>

<%= form_tag '#', :method => 'get', :class => 'form-inline' do %>
  <%= collection_select :filter, :event_type_id, EventType.all, :id, :name, {:include_blank => 'Ereignis-Typ', :class => 'form-control'}, :multiple => true %>
  <%= collection_select :filter, :sensor_id, Sensor.all, :id, :name, {:include_blank => 'Lichtschranke', :class => 'form-control'}, :multiple => true %>
<!--   <%= collection_select :filter, 'precipitation_amounts', Precipitation.amounts, :to_s, :to_s, {:include_blank => 'Niederschlagsmenge', :class => 'form-control'}, :multiple => true %> -->

  <%= text_field_tag :from_time, session[:from_time], :class => 'form-control' %>
  <%= text_field_tag :to_time, session[:to_time], :class => 'form-control' %>
  <button type="submit" class="btn btn-primary">Gönn' mir!</button>
<% end %>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Zeitpunkt</th>
      <th>Sensor</th>
      <th>Niederschlag</th>
      <th>Temperatur</th>
      <th>Typ</th>
      <th>Kommentar</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= event.timestamp %></td>
        <td><%= event.sensor.try :name %></td>
        <td>
          <%= event.precipitation.try(:amount) || '???' %>mm/h
          <% if event.precipitation.try(:amount).to_f > 0 %>
            <%= image_tag 'rain.png' %>
          <% end %>
        </td>
        <td><%= event.temperature.try(:min) || '??' %>°C/<%= event.temperature.try(:max) || '??' %>°C</td>
        <td><%= event.event_type.try :name %></td>
        <td><%= event.image.try :annotations %></td>
        <td><%= link_to t('nav.btn.edit'), edit_event_path(event) %></td>
        <td><%= link_to t('nav.btn.destroy'), event, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Event', new_event_path %>
